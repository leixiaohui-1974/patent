# PF1-5：一种长距离输水明渠基于稀疏监测的分布式水力状态在线估计方法

## （一）技术领域

本发明属于水利工程自动控制与信号处理交叉技术领域，具体涉及一种长距离输水明渠基于稀疏监测的分布式水力状态在线估计方法，适用于长距离输水明渠、区域水网等水利工程中利用有限数量的水位和流量传感器在线重构全渠道分布式水力状态，为水网运行操作系统（HydroOS）的控制引擎提供完整的实时状态信息。

## （二）背景技术

长距离输水明渠的实时控制需要掌握全渠道的水位和流量分布状态。以南水北调中线工程为例，总干渠全长1432km，沿线设有60余座节制闸，划分为约60个渠池，每个渠池长度从数公里到数十公里不等。精确控制要求不仅需要知道闸前闸后的水位和过闸流量，还需要了解渠池中间段的水位分布、流量传播过程和波前位置等分布式状态信息。

然而，传感器的布设受到经济成本、安装条件和维护难度等多方面限制。典型的输水明渠监测配置为：每座节制闸上下游各设1个水位计和1个流量计（或用闸门开度-水位反算流量），即每个渠池仅有2~4个测点。对于一个长20~30km的渠池而言，传感器密度仅约每5~15km一个测点，远低于水动力模型计算断面的密度（通常每200~500m一个计算断面）。这种传感器稀疏布设的现实条件导致以下技术问题：

（1）传感器覆盖的空间间隙大，渠池中间段的水力状态（水位、流量）无法直接测量——当渠池中间段发生局部水位异常（如侧向漏水、渠堤溃决初兆、渠底淤积抬高等）时，仅靠渠池两端的传感器可能无法及时发现，存在安全隐患（Malaterre P O, Rogers D C, Schuurmans J. Classification of canal control algorithms. Journal of Irrigation and Drainage Engineering, 1998, 124(1): 3-10）。

（2）传感器测量存在噪声、零漂和偶发故障——水位计受风浪、水草附着等干扰，超声波流量计受悬浮物浓度和温度变化影响，测量精度通常在±1~5 cm（水位）和±2~8%（流量）范围内。直接使用含噪声的稀疏测量数据进行控制决策，可能导致控制器性能下降或产生不必要的调节动作。

（3）缺乏系统化的模型-数据融合方法——目前大多数输水明渠控制系统直接使用传感器原始数据或简单的移动平均滤波数据，未充分利用水动力模型提供的物理约束信息。水动力模型（如Saint-Venant方程）蕴含了水流传播、衰减和反射的物理规律，可以填补传感器之间的空间间隙，但现有系统缺乏将模型预测与传感器测量在统一框架下融合的方法（Wahlin B T, Clemmens A J. Automatic downstream water-level feedback control of branching canal networks: theory. Journal of Irrigation and Drainage Engineering, 2006, 132(1): 3-14）。

（4）缺乏基于状态估计残差的异常检测能力——当传感器发生故障（如零漂、卡死、量程溢出）或渠道发生异常工况（如非计划取水、渠道渗漏突然加大）时，现有系统依赖独立的阈值报警机制，缺乏利用模型-数据一致性进行综合异常判别的手段。

（5）计算复杂度与实时性的矛盾——基于完整Saint-Venant方程的扩展卡尔曼滤波（EKF）虽然理论上可行，但对千公里级渠道而言，状态向量维度可达数千维，协方差矩阵的更新和存储量达到O(n²)量级，计算时间远超实时控制的毫秒级要求（Litrico X, Fromion V. Modeling and Control of Hydrosystems. Springer, 2009）。

综上所述，亟需一种兼顾计算效率与估计精度的分布式水力状态在线估计方法，能够利用稀疏传感器测量与水动力模型预测的融合，在线重构全渠道的水位和流量分布状态，并具备传感器故障检测和水力异常识别能力。

## （三）发明内容

### 1. 技术问题

本发明要解决的技术问题是：长距离输水明渠传感器布设稀疏，仅渠池两端有限测点无法直接获得全渠道分布式水力状态，传感器测量含噪声且可能故障，现有系统缺乏将水动力模型物理约束与传感器数据在统一框架下融合的在线状态估计方法，且基于完整PDE模型的卡尔曼滤波计算复杂度过高，难以满足实时控制要求。

### 2. 技术方案

为解决上述技术问题，本发明提供一种长距离输水明渠基于稀疏监测的分布式水力状态在线估计方法，包括以下步骤：

**步骤一：建立基于传递函数模型的降阶状态空间表示。**

以渠池为单元，利用IDZ（积分延迟零）传递函数模型建立降阶状态空间方程。对于单个渠池，将IDZ传递函数模型：

P(s) = (1 + τ_z · s) · e^(-τ_d · s) / (A_s · s)

通过Padé近似处理纯延迟项（一阶Padé：e^(-τ_d·s) ≈ (1 - τ_d·s/2) / (1 + τ_d·s/2)；对延迟时间τ_d较大的长渠池可采用二阶或三阶Padé以提高近似精度），并结合零点项，转化为有理传递函数，再通过可控标准型实现为状态空间方程：

ẋ(t) = A·x(t) + B·u(t) + w(t)
y(t) = C·x(t) + v(t)

其中：
- x(t)为渠池降阶状态向量，维度d = 2~4（对应IDZ模型的2~4阶实现），包含渠池蓄量偏差、流量传播延迟状态等集总变量；
- u(t)为输入向量，包括上游闸门过流量变化ΔQ_up和下游闸门过流量变化ΔQ_dn（由PF1-4统一执行器模型提供）；
- y(t)为输出向量，包括渠池上游端水位偏差ΔH_up和下游端水位偏差ΔH_dn；
- A、B、C为由IDZ传递函数参数（A_s、τ_d、τ_z）确定的系统矩阵；
- w(t)为过程噪声向量，协方差矩阵Q_w，表征模型不确定性；
- v(t)为测量噪声向量，协方差矩阵R_v，表征传感器不确定性。

对于N个渠池串联组成的渠段，通过边界耦合条件（相邻渠池共享闸门，第i个渠池的下游出流等于第i+1个渠池的上游入流）将各渠池状态空间模型串联，得到全渠段降阶状态空间模型：

ẋ_g(t) = A_g·x_g(t) + B_g·u_g(t) + w_g(t)
y_g(t) = C_g·x_g(t) + v_g(t)

其中x_g = [x₁ᵀ, x₂ᵀ, ..., x_Nᵀ]ᵀ为全局状态向量，维度D = N·d（对N = 60个渠池、d = 3，D = 180维），远小于PDE模型的数千维。A_g为分块三对角矩阵（体现相邻渠池耦合），具有稀疏结构。

**步骤二：设计分布式卡尔曼滤波器。**

基于步骤一的降阶状态空间模型，设计两层分布式卡尔曼滤波器：

（a）第一层——渠池级本地卡尔曼滤波器：

对每个渠池i独立运行一个小维度卡尔曼滤波器（维度d = 2~4）：

预测步骤：
x̂ᵢ⁻(k) = Aᵢ·x̂ᵢ(k-1) + Bᵢ·uᵢ(k-1)
Pᵢ⁻(k) = Aᵢ·Pᵢ(k-1)·Aᵢᵀ + Q_w,i

更新步骤（当渠池i有传感器测量可用时）：
Kᵢ(k) = Pᵢ⁻(k)·Cᵢᵀ·[Cᵢ·Pᵢ⁻(k)·Cᵢᵀ + R_v,i]⁻¹
x̂ᵢ(k) = x̂ᵢ⁻(k) + Kᵢ(k)·[yᵢ(k) - Cᵢ·x̂ᵢ⁻(k)]
Pᵢ(k) = [I - Kᵢ(k)·Cᵢ]·Pᵢ⁻(k)

其中x̂ᵢ⁻(k)为预测估计，x̂ᵢ(k)为更新后估计，Pᵢ(k)为估计误差协方差矩阵，Kᵢ(k)为卡尔曼增益。

本地滤波器的计算复杂度为O(d³)，对d = 3仅需约27次浮点运算，单步计算时间＜0.001 ms。

（b）第二层——渠段级邻域信息融合：

本地滤波器仅使用本渠池的传感器数据，未利用相邻渠池的信息。通过邻域融合步骤，将相邻渠池的状态估计信息传递至本渠池，提升估计精度：

对渠池i，其邻域渠池集合为N(i) = {i-1, i+1}（首末渠池为单侧邻域）。融合步骤采用协方差交叉（Covariance Intersection, CI）方法：

x̂ᵢ_fused(k) = Pᵢ_fused(k)·[ωᵢ·Pᵢ(k)⁻¹·x̂ᵢ(k) + Σⱼ∈N(i) ωⱼ·Pⱼ(k)⁻¹·Ψᵢⱼ·x̂ⱼ(k)]
Pᵢ_fused(k)⁻¹ = ωᵢ·Pᵢ(k)⁻¹ + Σⱼ∈N(i) ωⱼ·Pⱼ(k)⁻¹

其中ωᵢ和ωⱼ为融合权重（ωᵢ + Σωⱼ = 1），Ψᵢⱼ为从渠池j状态空间到渠池i状态空间的映射矩阵。Ψᵢⱼ基于相邻渠池的边界耦合关系推导：对于共享闸门连接的相邻渠池i和j，Ψᵢⱼ的构造方法为——将渠池j的下游边界状态（水位偏差、流量偏差）通过闸门过流方程映射为渠池i的上游边界条件，具体映射系数由闸门线性化参数（PF1-4中的β_up、β_dn）确定。融合权重通过最小化融合后协方差矩阵的迹来优化确定。

邻域融合每隔N_fuse个本地滤波步骤执行一次（N_fuse = 5~20），通信量为每个渠池向邻域发送状态估计x̂ᵢ和协方差Pᵢ（总共d + d²个浮点数，对d = 3为12个浮点数）。

**步骤三：建立分布式状态到全渠道空间分布的状态重构方法。**

步骤二的卡尔曼滤波器输出的是每个渠池的集总降阶状态x̂ᵢ（维度d = 2~4），需要将其重构为渠池内沿程的水位和流量空间分布H(x,t)和Q(x,t)。

（a）基于IDZ模型的渠池内部水位分布重构：

利用IDZ传递函数模型的频域解析解，渠池内任意位置x处的水位偏差可由上下游边界水位偏差ΔH_up和ΔH_dn通过空间插值获得。对于低频工况（准稳态），渠池内水位近似为上下游水位的线性插值：

ΔH(x,t) ≈ (1 - x/L)·ΔH_up(t) + (x/L)·ΔH_dn(t)

对于高频工况（快速过渡态），引入波传播修正项：

ΔH(x,t) ≈ (1 - x/L)·ΔH_up(t - x/c₊) + (x/L)·ΔH_dn(t - (L-x)/c₋) + ΔH_reflect(x,t)

其中c₊ = v₀ + c₀为顺波速度，c₋ = c₀ - v₀为逆波速度，ΔH_reflect为边界反射波贡献（由IDZ模型的零点特性确定）。

（b）流量空间分布重构：

利用连续性方程∂A/∂t + ∂Q/∂x = 0（无侧向入流时），由已知的水位时间变化率∂H/∂t（从状态估计时间序列求得）和水位空间分布求得流量空间分布：

Q(x,t) = Q(0,t) - ∫₀ˣ T(x')·∂H(x',t)/∂t dx'

其中T(x')为位置x'处的水面宽度，Q(0,t)为上游边界流量（已知）。

（c）估计置信区间计算：

利用卡尔曼滤波器的协方差矩阵Pᵢ，计算重构后水位和流量的空间分布估计标准差σ_H(x)和σ_Q(x)。一般规律为：越靠近传感器位置，估计标准差越小；渠池中间段距离两端传感器最远处，估计标准差最大。置信区间为x̂(x) ± z_α·σ(x)（z_α为置信系数，95%置信区间取z_α = 1.96）。

**步骤四：建立基于新息序列的多源异常检测方法。**

卡尔曼滤波器的新息序列（Innovation Sequence）定义为测量值与模型预测值之差：

νᵢ(k) = yᵢ(k) - Cᵢ·x̂ᵢ⁻(k)

在正常运行条件下，新息序列服从零均值高斯分布νᵢ(k) ~ N(0, Sᵢ(k))，其中Sᵢ(k) = Cᵢ·Pᵢ⁻(k)·Cᵢᵀ + R_v,i为新息协方差矩阵。利用新息序列的统计特性进行多源异常检测：

（a）传感器故障检测：

计算归一化新息平方和（NIS）：

NISᵢ(k) = νᵢ(k)ᵀ·Sᵢ(k)⁻¹·νᵢ(k)

在正常条件下，NISᵢ(k)服从自由度为m（m为测量维度）的卡方分布χ²(m)。设定检测阈值γ_sensor = χ²_α(m)（α为显著性水平，如α = 0.01），当NISᵢ(k) > γ_sensor时，判定渠池i的传感器可能存在故障。

进一步的传感器故障隔离：当检测到异常后，分别检查各传感器分量的归一化新息：对水位传感器，ν_H(k)² / S_HH(k) > γ₁则水位传感器故障；对流量传感器，ν_Q(k)² / S_QQ(k) > γ₂则流量传感器故障。

（b）水力异常检测：

当传感器已排除故障后，新息序列持续偏离零均值（偏移检测），可能指示水力异常事件：

- 单侧偏移：ν̄ᵢ(W) = (1/W)·Σ_w νᵢ(k-W+w) ≠ 0，采用CUSUM（累积和）检验：
  S⁺(k) = max(0, S⁺(k-1) + νᵢ(k) - μ_drift)
  S⁻(k) = min(0, S⁻(k-1) + νᵢ(k) + μ_drift)
  当S⁺(k) > h或S⁻(k) < -h时判定发生水力异常。其中h为检测阈值，由可接受的误报率（ARL₀）和最小可检测偏移量μ_drift共同确定：h = -μ_drift/2·ln(2·Φ(-μ_drift/(2σ_ν)) - 1)的近似值，实际工程中h取3~5倍新息标准差σ_ν，μ_drift取1~2倍σ_ν，对应误报平均间隔ARL₀ > 500步。

- 异常类型分类：根据新息偏移的模式（哪些渠池、哪些测量分量出现异常）进行分类——上游水位持续偏高+下游水位正常→可能为中间段侧向漏水；上下游水位同时偏低→可能为上游来水减少；流量新息偏大+水位新息正常→可能为流量传感器零漂。

（c）传感器故障后的降级运行策略：

当检测到某传感器故障后，卡尔曼滤波器自动切换至降级模式：将故障传感器对应的测量噪声方差R_v,i的对应分量放大至极大值（如放大1000倍），等效于忽略该传感器的测量信息，滤波器退化为纯模型预测。同时，增大邻域融合频率（N_fuse减半），借助相邻渠池的健康传感器信息补偿信息缺失。

**步骤五：建立状态估计器的在线自校准方法。**

卡尔曼滤波器的性能取决于过程噪声协方差Q_w和测量噪声协方差R_v的准确设定。本步骤建立基于新息序列的Q_w和R_v在线自校准方法。

（a）测量噪声协方差R_v的在线估计：

利用新息协方差自一致性条件：理论新息协方差S(k)应等于实际新息样本协方差。在滑动窗口W_R内计算新息样本协方差：

Ŝ(W_R) = (1/W_R)·Σ_{j=k-W_R+1}^{k} νᵢ(j)·νᵢ(j)ᵀ

由S(k) = C·P⁻(k)·Cᵀ + R_v，当模型和Q_w正确时，R̂_v = Ŝ(W_R) - C·P⁻·Cᵀ。若R̂_v的对角元素发生显著变化（超过初始值的±50%），则更新R_v。

（b）过程噪声协方差Q_w的在线调整：

采用自适应卡尔曼滤波的Myers-Tapley方法：

Q̂_w(k) = (1/W_Q)·Σ_{j=k-W_Q+1}^{k} [K(j)·ν(j)·ν(j)ᵀ·K(j)ᵀ + P(j) - A·P(j-1)·Aᵀ]

其中W_Q为滑动窗口长度。Q̂_w的更新频率低于滤波频率（每W_Q步更新一次），以避免Q_w频繁波动。

（c）模型偏差补偿：当新息统计分析表明系统性偏差无法通过Q_w调整消除时（可能因渠道糙率变化、断面淤积等导致模型系统误差），引入偏差状态增广：

在状态向量中增加偏差项b：x_aug = [x; b]ᵀ，其中b为缓慢变化的模型偏差向量，动力学方程为b(k) = b(k-1) + w_b(k)（随机游走模型，w_b的方差Q_b远小于Q_w）。增广后的卡尔曼滤波器可同时估计水力状态和模型偏差。

### 3. 有益效果

采用本发明的技术方案，与现有技术相比具有以下有益效果：

（1）利用IDZ传递函数模型建立降阶状态空间表示，将全渠道状态向量维度从PDE模型的数千维降至180维（60个渠池×3维/渠池），卡尔曼滤波计算复杂度从O(n³) ≈ O(10⁹)降至分布式计算的O(N·d³) ≈ O(60×27) = O(1620)，单步计算时间从秒级降至＜0.1 ms，满足实时控制的毫秒级要求。

（2）两层分布式卡尔曼滤波器结构（本地滤波+邻域融合）兼顾计算效率与估计精度：本地滤波器利用本渠池传感器实现高频状态更新，邻域融合利用相邻渠池信息提升中间段估计精度，通信量极小（每次融合每个渠池仅发送12个浮点数）。

（3）基于IDZ模型的渠池内部状态重构方法将集总状态展开为空间分布，在准稳态下为上下游线性插值，在过渡态引入波传播修正，可提供全渠道任意位置的水位和流量估计值及其置信区间。

（4）基于新息序列的多源异常检测方法可同时识别传感器故障和水力异常事件，传感器故障后自动降级运行，借助邻域融合补偿信息缺失，保障状态估计的连续性。

（5）基于新息自一致性的在线自校准方法可自动跟踪传感器噪声特性变化和模型偏差，无需人工重新调参，提高状态估计器的长期运行鲁棒性。

## （四）附图说明

**图1** 为本发明分布式水力状态在线估计系统总体架构图，展示从传感器数据采集、降阶状态空间建模、分布式卡尔曼滤波、空间状态重构到异常检测的完整数据流程。

**图2** 为两层分布式卡尔曼滤波器结构示意图，展示渠池级本地滤波器和渠段级邻域信息融合的层次关系及信息传递路径。

**图3** 为渠池内部水位空间分布重构原理图，分别展示准稳态线性插值和过渡态波传播修正两种模式下的重构结果。

**图4** 为基于新息序列的多源异常检测流程图，展示NIS检验（传感器故障检测）、CUSUM检验（水力异常检测）和降级运行策略的判定逻辑。

**图5** 为南水北调中线工程实施例中安阳段3渠池24小时状态估计结果图，展示估计水位与实测水位的对比、估计置信区间以及新息序列统计特性。

## （五）具体实施方式

下面结合南水北调中线工程总干渠运行场景，对本发明的技术方案进行详细说明。

### 实施例：南水北调中线安阳段3渠池24小时分布式状态估计

**1. 工程概况与传感器配置**

选取南水北调中线总干渠安阳段3个连续渠池（渠池P1: 桩号580~600km，渠池P2: 600~630km，渠池P3: 630~660km），分别由节制闸G1、G2、G3、G4控制，总长80km。各渠池梯形断面，底宽b = 16.0 m，边坡系数m = 2.5，纵底坡S₀ = 1/25000，Manning糙率n = 0.015。设计流量Q₀ = 120 m³/s，设计水深y₀ = 5.0 m。

传感器配置：

| 位置 | 传感器类型 | 精度 | 采样频率 |
|------|----------|------|----------|
| G1闸前（桩号580km） | 雷达水位计 | ±1 cm | 1 Hz |
| G1闸后（桩号580.1km） | 雷达水位计 | ±1 cm | 1 Hz |
| G2闸前（桩号600km） | 雷达水位计 | ±1 cm | 1 Hz |
| G2闸后（桩号600.1km） | 雷达水位计 | ±1 cm | 1 Hz |
| G3闸前（桩号630km） | 雷达水位计 | ±1 cm | 1 Hz |
| G3闸后（桩号630.1km） | 雷达水位计 | ±1 cm | 1 Hz |
| G4闸前（桩号660km） | 雷达水位计 | ±1 cm | 1 Hz |
| G1~G4各闸 | 闸门开度传感器 | ±0.5 cm | 1 Hz |

过闸流量由闸门开度与上下游水位通过PF1-4统一执行器模型计算获得。渠池中间段（如P2渠池的桩号615km处）无传感器——这是需要通过状态估计重构的关键区域。

**2. 降阶状态空间模型建立**

各渠池IDZ传递函数参数（参照PF1-1方法计算）：

| 渠池 | 长度L (km) | 蓄量面积A_s (m²) | 延迟时间τ_d (s) | 零点时间τ_z (s) |
|------|-----------|------------------|----------------|----------------|
| P1 | 20 | 520,000 | 2857 (≈47.6 min) | 1234 |
| P2 | 30 | 780,000 | 4286 (≈71.4 min) | 1851 |
| P3 | 30 | 780,000 | 4286 (≈71.4 min) | 1851 |

以渠池P2为例，IDZ传递函数经一阶Padé近似和状态空间实现后得到3阶状态空间模型（d = 3）：

A₂ = [0, 1, 0; 0, 0, 1; -a₃, -a₂, -a₁]
B₂ = [0; 0; b₃]·[1, -1]（两列对应上游入流和下游出流）
C₂ = [c₁, c₂, c₃; c₄, c₅, c₆]（两行对应上游水位和下游水位输出）

其中系数a₁~a₃、b₃、c₁~c₆由A_s、τ_d、τ_z的具体数值确定。

3个渠池串联的全局状态向量x_g = [x₁ᵀ, x₂ᵀ, x₃ᵀ]ᵀ，维度D = 9。全局系统矩阵A_g为9×9分块三对角矩阵。

过程噪声协方差初始设定：Q_w = diag(σ²_w1, σ²_w2, σ²_w3)·I₃ = diag(10⁻⁴, 10⁻⁵, 10⁻⁶)·I₃（单位与状态变量一致）。
测量噪声协方差初始设定：R_v = σ²_H·I₂ = (0.01)²·I₂ = 10⁻⁴·I₂ m²（对应±1 cm水位精度）。

**3. 分布式卡尔曼滤波器运行**

卡尔曼滤波器参数设定：

| 参数 | 值 | 说明 |
|------|-----|------|
| 滤波周期 | Δt = 10 s | 与IDZ模型离散化步长一致 |
| 邻域融合频率 | N_fuse = 10 | 每100 s融合一次 |
| 初始状态 | x̂(0) = 0 | 稳态偏差为零 |
| 初始协方差 | P(0) = I·10⁻² | 初始不确定性较小 |

**24小时运行场景与状态估计过程：**

**阶段A（00:00-06:00，夜间稳态运行）：**

- 系统处于稳态Q₀ = 120 m³/s，水位变化微小
- 各渠池本地卡尔曼滤波器工作在"稳态模式"：预测步骤的状态几乎不变，更新步骤小幅修正测量噪声
- P2渠池中间段（桩号615km）状态重构：ΔH(615km) ≈ 0.5·ΔH_up + 0.5·ΔH_dn ≈ 0 ± 0.7 cm（线性插值，置信区间由协方差传播计算得到——中间段标准差约为端部的√2倍）
- 新息序列NIS均值：1.05（接近理论值m=2的自由度，χ²(2)均值=2），正常范围
- 卡尔曼增益收敛至稳态值K_ss

**阶段B（06:00-08:00，大流量过渡过程）：**

- 06:00，下游需水量从30增至55 m³/s，闸门调整引起流量和水位快速变化
- 本地滤波器检测到测量值与预测值偏差增大（新息幅值增加），自动增大卡尔曼增益以更快跟踪状态变化
- P2渠池中间段状态重构切换至波传播修正模式：
  ΔH(615km, t) = 0.5·ΔH_up(t - 15km/7m/s) + 0.5·ΔH_dn(t - 15km/5m/s) + ΔH_reflect
  其中c₊ ≈ 7 m/s（顺波速），c₋ ≈ 5 m/s（逆波速，v₀=1m/s, c₀=6m/s）
  顺波延迟 ≈ 15000/7 ≈ 2143 s ≈ 35.7 min
  逆波延迟 ≈ 15000/5 ≈ 3000 s ≈ 50.0 min
- 06:40，P2中间段估计水位开始下降（顺波到达），估计值ΔH = -8.5 cm ± 2.1 cm
- 邻域融合将P1和P3的状态信息传递至P2，进一步收窄P2中间段的估计不确定性：融合后σ_H(615km)从2.1 cm降至1.6 cm

**阶段C（12:00-12:05，传感器故障模拟）：**

- 12:00，模拟G2闸前水位传感器发生零漂故障：实测值在真值基础上附加+5 cm持续偏移
- 12:00:30（3个滤波步骤后），NIS₂(k)跳升至8.7，超过检测阈值γ_sensor = χ²₀.₀₁(2) = 9.21——尚未触发
- 12:01:00（6个步骤后），NIS₂连续3步超过5.0，累积NIS均值达7.2，归一化水位新息|ν_H|/√S_HH = 4.8 > γ₁ = 3.0，判定G2闸前水位传感器故障
- 滤波器自动进入降级模式：R_v,2的水位分量从10⁻⁴放大至10⁻¹（放大1000倍），邻域融合频率从N_fuse = 10降至N_fuse = 5
- 降级模式下P2渠池的状态估计主要依赖：（1）模型预测；（2）G2闸后水位传感器（仍正常）；（3）P1和P3邻域融合信息
- P2渠池中间段估计标准差从正常的1.6 cm增至2.8 cm，仍在可接受范围内

**阶段D（15:00-15:30，渠道渗漏异常检测）：**

- 15:00，模拟P2渠池桩号618km处发生渠底渗漏（渗漏流量2 m³/s）
- 渗漏导致P2渠池蓄量逐渐减小，G2闸后水位缓慢下降、G3闸前水位缓慢下降
- 新息序列出现单侧偏移：P2下游水位新息持续为负（实测水位低于模型预测）
- CUSUM检测：15:10（渗漏开始10分钟后），S⁻(k)达到检测阈值h = 4.0σ，触发水力异常报警
- 异常类型分类：P2下游水位新息偏低+P3上游水位新息偏低+流量新息正常 → 判定为P2渠池中间段侧向损失（渗漏）
- 系统生成报警信息：P2渠池桩号610~630km段可能存在渗漏，建议现场巡查

**4. 状态估计精度验证**

在P2渠池桩号615km处临时安装高精度水位计（±0.5 cm）作为验证基准（不参与状态估计），24小时验证结果：

| 指标 | 数值 |
|------|------|
| 水位估计均方根误差（RMSE） | 1.4 cm（稳态期0.8 cm，过渡期2.3 cm） |
| 水位估计最大绝对误差 | 3.8 cm（大流量过渡期波前到达时刻） |
| 95%置信区间覆盖率 | 96.2%（略高于理论95%，表明估计偏保守） |
| 流量估计RMSE（由水位重构推算） | 1.2 m³/s（约1%） |
| 传感器故障检测延迟 | 60 s（6个滤波步骤） |
| 水力异常（渗漏）检测延迟 | 10 min |
| 单步滤波计算时间（3个渠池） | 0.02 ms（本地滤波）+ 0.005 ms（邻域融合）= 0.025 ms |
| 邻域融合通信量 | 每次36个浮点数（3渠池×12个/渠池） |

**5. 全渠道扩展性分析**

将本方法推广至南水北调中线全渠道60个渠池的性能估计：

| 指标 | 3渠池实施例 | 60渠池全渠道推算 |
|------|-----------|-----------------|
| 全局状态维度 | 9 | 180 |
| 本地滤波总计算量 | O(81) | O(1620) |
| 单步总计算时间 | 0.025 ms | ＜0.5 ms |
| 邻域融合通信量 | 36个浮点数 | 720个浮点数（约5.6 KB） |
| 内存占用 | ＜1 KB | ＜20 KB |

分布式架构的关键优势：计算量与渠池数N线性增长O(N·d³)，而非集中式EKF的O(D³) = O(N³·d³)——60个渠池时分布式方法比集中式快约60²= 3600倍。

## （六）权利要求书

**权利要求1.** 一种长距离输水明渠基于稀疏监测的分布式水力状态在线估计方法，用于利用有限数量的水位和流量传感器在线重构全渠道分布式水力状态，其特征在于，包括以下步骤：

步骤一：建立基于降阶模型的状态空间表示，以渠池为单元，将水动力传递函数模型通过Padé近似和状态空间实现转化为低阶状态空间方程，各渠池通过边界耦合条件串联得到全渠段降阶状态空间模型，状态向量维度远小于PDE数值模型；

步骤二：设计两层分布式卡尔曼滤波器，第一层为渠池级本地卡尔曼滤波器，对每个渠池独立运行小维度卡尔曼滤波器进行状态预测和测量更新；第二层为渠段级邻域信息融合，将相邻渠池的状态估计信息通过协方差交叉方法融合至本渠池；

步骤三：建立分布式状态到全渠道空间分布的状态重构方法，将渠池级集总状态展开为渠池内沿程的水位和流量空间分布，并计算估计置信区间；

步骤四：建立基于新息序列的多源异常检测方法，利用卡尔曼滤波器新息序列的统计特性进行传感器故障检测和水力异常事件识别，检测到传感器故障后自动切换至降级运行模式。

**权利要求2.** 根据权利要求1所述的方法，其特征在于，步骤一中所述降阶状态空间表示的建立方法为：将IDZ传递函数的纯延迟项通过Padé近似转化为有理传递函数，再通过可控标准型实现为状态空间方程，每个渠池的状态向量维度为2~4维。

**权利要求3.** 根据权利要求1所述的方法，其特征在于，步骤一中所述全渠段降阶状态空间模型的全局系统矩阵为分块三对角稀疏矩阵，体现相邻渠池的边界耦合关系，全局状态向量维度为渠池数量与单渠池状态维度的乘积。

**权利要求4.** 根据权利要求1所述的方法，其特征在于，步骤二中所述渠池级本地卡尔曼滤波器的单步计算复杂度为O(d³)，其中d为单渠池状态维度；所述渠段级邻域信息融合采用协方差交叉方法，融合权重通过最小化融合后协方差矩阵的迹来优化确定。

**权利要求5.** 根据权利要求4所述的方法，其特征在于，所述邻域信息融合每隔预设步数执行一次，每次融合每个渠池向邻域发送状态估计向量和协方差矩阵，通信量为单渠池状态维度与其平方之和个浮点数。

**权利要求6.** 根据权利要求1所述的方法，其特征在于，步骤三中所述状态重构方法包括：在准稳态下采用上下游水位偏差的线性插值获得渠池内任意位置的水位估计；在过渡态下引入波传播修正项，考虑顺波和逆波的传播延迟及边界反射波贡献。

**权利要求7.** 根据权利要求6所述的方法，其特征在于，步骤三中所述流量空间分布重构方法为：利用连续性方程和已知的水位时间变化率，由上游边界流量沿程积分水面宽度与水位变化率的乘积获得任意位置的流量估计。

**权利要求8.** 根据权利要求1所述的方法，其特征在于，步骤四中所述传感器故障检测方法为：计算新息序列的归一化新息平方和NIS，与卡方分布的检测阈值比较；检测到异常后，进一步检查各传感器分量的归一化新息以隔离故障传感器。

**权利要求9.** 根据权利要求1所述的方法，其特征在于，步骤四中所述水力异常检测方法为：在排除传感器故障后，采用CUSUM累积和检验检测新息序列的单侧偏移，并根据多个渠池多个测量分量的新息偏移模式对异常类型进行分类。

**权利要求10.** 根据权利要求1所述的方法，其特征在于，步骤四中所述降级运行模式为：将故障传感器对应的测量噪声方差放大至极大值以忽略其测量信息，同时增大邻域融合频率以借助相邻渠池健康传感器信息补偿信息缺失。

**权利要求11.** 根据权利要求1所述的方法，其特征在于，还包括步骤五：建立状态估计器的在线自校准方法，利用新息序列的统计特性在线估计和更新测量噪声协方差和过程噪声协方差，并通过偏差状态增广方法补偿模型系统偏差。

**权利要求12.** 根据权利要求11所述的方法，其特征在于，所述偏差状态增广方法为：在状态向量中增加缓慢变化的偏差项，其动力学方程为随机游走模型，增广后的卡尔曼滤波器可同时估计水力状态和模型偏差。

**权利要求13.** 一种长距离输水明渠基于稀疏监测的分布式水力状态在线估计系统，其特征在于，包括：
- 降阶建模模块，用于将各渠池IDZ传递函数转化为状态空间方程并串联为全渠段降阶模型；
- 分布式滤波模块，包括渠池级本地卡尔曼滤波器和渠段级邻域融合器；
- 状态重构模块，用于将集总状态展开为全渠道水位和流量的空间分布；
- 异常检测模块，用于基于新息序列进行传感器故障检测、故障隔离和水力异常分类；
- 自校准模块，用于在线更新噪声协方差和补偿模型偏差。

## （七）摘要

本发明公开了一种长距离输水明渠基于稀疏监测的分布式水力状态在线估计方法及系统，属于水利工程自动控制与信号处理交叉技术领域。该方法以渠池为单元，将IDZ传递函数模型通过Padé近似转化为低阶状态空间方程，建立全渠段降阶状态空间模型。设计两层分布式卡尔曼滤波器：第一层渠池级本地滤波器对每个渠池独立运行小维度卡尔曼滤波实现高频状态更新，第二层渠段级邻域融合通过协方差交叉方法利用相邻渠池信息提升中间段估计精度。建立渠池内部状态空间重构方法，在准稳态下线性插值、在过渡态引入波传播修正。利用新息序列的统计特性实现传感器故障检测隔离和水力异常事件识别，传感器故障后自动降级运行。以南水北调中线安阳段3渠池24小时运行为实施例验证，渠池中间段水位估计均方根误差1.4 cm，传感器故障检测延迟60 s，渗漏异常检测延迟10 min，单步计算时间0.025 ms，分布式架构可线性扩展至全渠道60渠池，满足实时控制要求。
